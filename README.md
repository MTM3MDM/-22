# 루시아 디스코드 봇 - 고급 자연어 AI 어시스턴트 🚀

**완전 업그레이드된 고급 Gemini AI 디스코드 챗봇 - 응답 반복 문제 해결 및 대폭 기능 강화**

> 🎉 **대폭 업그레이드**: 응답 반복 문제 완전 해결, 웹 검색, 이미지 생성, 데이터 시각화, 시스템 모니터링 등 고급 기능 추가!

## 🌟 주요 업그레이드 내용

### ✅ 문제 해결
- **응답 반복 문제 완전 해결**: `stop_processing` 플래그로 중복 응답 방지
- **메모리 최적화**: 고급 세션 관리 및 자동 정리
- **성능 향상**: 비동기 처리 및 데이터베이스 연동

### 🚀 새로운 고급 기능
- **🔍 웹 검색**: 위키피디아 및 실시간 웹 검색
- **📊 데이터 시각화**: 차트 및 그래프 자동 생성
- **🖥️ 시스템 모니터링**: 실시간 성능 분석 및 상태 보고
- **💾 영구 저장**: SQLite 데이터베이스 연동
- **🎨 이미지 생성**: 차트, 상태 보고서 등 시각적 콘텐츠

## 🎯 핵심 특징

### 🧠 고급 AI 기능
- **Gemini 1.5 Flash**: 빠른 응답 및 일반 대화
- **Gemini 1.5 Pro**: 전문적 분석 및 복잡한 문제 해결
- **맥락 기억**: 40개 메시지까지 대화 히스토리 유지
- **개인화**: 사용자별 설정 및 선호도 저장
- **🎨 다양한 응답**: 같은 질문에도 매번 다른 스타일로 응답
- **🔄 반복 질문 감지**: "또 궁금하신가봐요~" 같은 자연스러운 반응

### 🔍 지능형 웹 검색 및 기억 시스템
- **SerpAPI 연동**: 실시간 구글 검색 결과 제공
- **기억 기능**: 이전 검색 내용을 기억하고 관련 질문에 활용
- **벡터 검색**: 유사한 질문을 찾아 기존 답변 재활용
- **캐싱 시스템**: 6시간 캐시로 빠른 응답
- **위키피디아 연동**: 정확한 백과사전 정보 제공

### 📊 데이터 시각화
- **자동 차트 생성**: "차트 그려줘"로 데이터 시각화
- **시스템 상태 이미지**: 성능 모니터링 결과를 이미지로 제공
- **통계 분석**: 사용 패턴 및 성능 지표 분석

### 👑 최고관리자 권한
- **사용자 ID**: `1295232354205569075` (절대 변경 불가)
- **무제한 액세스**: 모든 레이트 리미트 무시
- **자연어 관리**: "통계 보여줘", "전체 초기화해줘" 등

## 🚀 설치 및 실행

### 1. 의존성 설치
```bash
pip install -r requirements.txt
```

### 2. 환경 변수 설정
`.env` 파일 생성:
```env
# 필수 API 키
GEMINI_API_KEY=your_gemini_api_key_here
DISCORD_TOKEN=your_discord_bot_token_here

# 웹 검색 기능용 (선택적이지만 권장)
SERPAPI_KEY=your_serpapi_key_here

# 기타 선택적 키들
OPENWEATHER_API_KEY=your_weather_api_key_optional
YOUTUBE_API_KEY=your_youtube_api_key_optional
```

**SerpAPI 키 받는 방법:**
1. https://serpapi.com 방문
2. 무료 계정 생성 (월 100회 검색 무료)
3. API 키 복사해서 `.env` 파일에 추가

### 3. 봇 실행
```bash
python gemini_discord_bot.py
```

### 4. 웹 검색 기능 테스트 (선택적)
```bash
python test_web_search.py
```

## 💬 사용법 (모든 기능이 자연어로 작동)

### 🗣️ 일반 대화 (다양한 응답 스타일)
```
@루시아 안녕하세요!
→ "안녕하세요~ 어떤 질문이 있으신가요? ✨"

루시아 뭐해?
→ "실시간으로 정보를 모니터링하고 있어요 😊"

루시아 뭐해? (같은 질문 반복)
→ "또 궁금하신가봐요~ 이번엔 다르게 말해볼게요! 새로운 것들을 배우고 있어요 💕"

@루시아 파이썬 프로그래밍에 대해 알려주세요
루시아 재미있는 이야기 해주세요
```

### 🔍 지능형 웹 검색 기능
```
@루시아 GPT-5 언제 나와?
루시아 검색해줘 최신 AI 뉴스
@루시아 위키피디아에서 찾아줘 양자컴퓨터
루시아 GPT-5는 어떤 모델이야? (기억 기반 답변)
@루시아 검색 통계 보여줘
```

### 📊 데이터 시각화
```
루시아 차트 그려줘
@루시아 그래프 만들어줘
루시아 시각화해줘
```

### 🖥️ 시스템 모니터링
```
@루시아 시스템 상태 확인해줘
루시아 서버 상태 보여줘
@루시아 성능 모니터링 해줘
```

### ⚙️ 설정 관리
```
@루시아 내 설정 보여줘
루시아 프로 모델로 바꿔줘
@루시아 대화 초기화해줘
```

### 👑 관리자 전용 기능
```
루시아 전체 통계 보여줘
@루시아 시스템 리셋해줘
루시아 모든 데이터 초기화해줘
```

## 🎮 고급 자연어 기능들

### 🔍 지능형 검색 및 기억 시스템
- **"GPT-5 언제 나와?"** → SerpAPI로 실시간 검색 + 기억 저장
- **"GPT-5는 어떤 모델이야?"** → 기존 검색 기억에서 관련 답변
- **"검색해줘 [검색어]"** → 종합 웹 검색 (기억 기능 포함)
- **"위키피디아에서 찾아줘 [주제]"** → 위키피디아 검색
- **"검색 통계 보여줘"** → 검색 시스템 통계 및 성능

### 📊 데이터 시각화
- **"차트 그려줘"** → 샘플 데이터로 차트 생성
- **"그래프 만들어줘"** → 데이터 시각화
- **"시각화해줘"** → 통계 차트 생성

### 🖥️ 시스템 모니터링
- **"시스템 상태 확인해줘"** → CPU, 메모리, 디스크 사용률
- **"서버 상태 보여줘"** → 실시간 성능 지표
- **"모니터링해줘"** → 시스템 상태 이미지 생성

### 🤖 AI 모델 관리
- **"프로 모델로 바꿔줘"** → Gemini Pro로 변경
- **"플래시 모델로 바꿔줘"** → Gemini Flash로 변경
- **"어떤 모델 쓰고 있어?"** → 현재 모델 확인

### 🔄 대화 관리
- **"대화 초기화해줘"** → 대화 기록 완전 리셋
- **"새로 시작하자"** → 새 대화 세션 시작
- **"처음부터 다시"** → 대화 히스토리 클리어

### 📋 정보 확인
- **"내 설정 보여줘"** → 개인 설정 및 통계
- **"내 정보 알려줘"** → 사용자 프로필 정보
- **"현재 설정은?"** → 상세 설정 정보

### 👑 관리자 전용 (최고관리자만)
- **"전체 통계 보여줘"** → 봇 사용 통계 및 성능 지표
- **"시스템 리셋해줘"** → 모든 데이터 초기화
- **"모든 데이터 초기화해줘"** → 완전 시스템 리셋

## 🛡️ 보안 시스템

### 레이트 리미팅
- 일반 사용자: 분당 10개 메시지
- 최고관리자: 무제한

### 스팸 감지
- 반복 문자 패턴 감지
- 특수문자 남용 차단
- 자동 사용자 차단

### 자동 정리
- 1시간 비활성 세션 정리
- 메모리 최적화
- 로그 관리

## 📁 파일 구조
```
├── gemini_discord_bot.py           # 메인 봇 파일 (자연어 전용)
├── intelligent_web_search.py       # 지능형 웹 검색 시스템
├── dynamic_response_system.py      # 다양한 응답 생성 시스템
├── advanced_knowledge_system.py    # 고급 지식 시스템
├── advanced_web_search.py         # 웹 검색 모듈
├── test_web_search.py             # 웹 검색 테스트 스크립트
├── test_dynamic_responses.py       # 응답 다양성 테스트 스크립트
├── config.py                      # 설정 파일
├── requirements.txt               # 의존성 목록
├── .env                          # 환경 변수
├── .env.example                  # 환경 변수 예시
├── README.md                     # 이 파일
├── lucia_bot.db                  # 메인 데이터베이스
├── search_memory.db              # 검색 기억 데이터베이스
├── lucia_bot.log                 # 로그 파일
└── knowledge_base/               # 지식베이스 저장소
    └── chroma_db/               # 벡터 데이터베이스
```

## 🎨 다양한 응답 시스템 상세

### 🌈 응답 다양성 기능
1. **스타일 변화**: 캐주얼, 장난스러운, 전문적, 귀여운 스타일 자동 변경
2. **반복 감지**: 같은 질문 반복 시 "또 궁금하신가봐요~" 같은 자연스러운 반응
3. **기술 키워드 삽입**: 검색 결과에서 추출한 최신 기술 용어 자연스럽게 포함
4. **응답 기록**: 사용자별로 최근 응답 스타일 기억해서 다양성 보장

### 🎯 응답 패턴 예시
```
"뭐해?" 질문에 대한 다양한 응답들:

1회차: "실시간으로 정보를 모니터링하고 있어요 😊"
2회차: "또 궁금하신가봐요~ 새로운 것들을 배우고 있어요 💕"
3회차: "같은 질문이지만 새로운 답변으로 드릴게요 ✨ 데이터를 정리하고 분석하고 있어요."
4회차: "반복 질문도 환영이에요! 오늘은 GPT-5 뉴스가 흥미롭네요 🎉"
```

### 🔧 기술적 특징
- **응답 기록 저장**: SQLite DB에 사용자별 응답 히스토리 저장
- **스타일 순환**: 이전 스타일과 다른 스타일 자동 선택
- **키워드 자동 업데이트**: 웹 검색 결과에서 최신 기술 용어 추출
- **시간 기반 필터링**: 1시간 내 반복 질문만 감지

## 🧠 지능형 웹 검색 시스템 상세

### 🔍 핵심 기능
1. **실시간 검색**: SerpAPI를 통한 구글 검색 결과
2. **기억 시스템**: 벡터 임베딩으로 검색 내용 저장
3. **관련성 판단**: 유사한 질문 자동 감지 (코사인 유사도 0.8 이상)
4. **캐싱**: 6시간 동안 동일 검색 결과 재사용
5. **통계 추적**: 검색 횟수, 응답 시간, 만족도 분석

### 🎯 작동 방식
```
사용자: "GPT-5 언제 나와?"
→ 1. 기존 검색 기록에서 유사한 질문 찾기
→ 2. 없으면 SerpAPI로 실시간 검색
→ 3. 결과를 요약하고 벡터로 저장
→ 4. 사용자에게 답변 제공

사용자: "GPT-5는 어떤 모델이야?"
→ 1. 벡터 검색으로 관련 기억 발견 (유사도 0.85)
→ 2. 기존 검색 내용 기반으로 답변
→ 3. "기억에서 찾은 답변" 표시
```

### 📊 검색 결과 구성
- **즉시 답변**: Google Answer Box 내용
- **주요 검색 결과**: 상위 3-5개 결과 요약
- **관련 질문**: Google의 "관련 검색어" 제공
- **지식 그래프**: 인물/기업/개념 정보
- **관련 기억**: 이전 검색과의 연관성 표시

### 🗄️ 데이터 저장
- **SQLite 데이터베이스**: 검색 기록 영구 저장
- **FAISS 벡터 인덱스**: 빠른 유사성 검색
- **메모리 캐시**: 최근 검색 결과 임시 저장
- **분석 데이터**: 성능 지표 및 사용 통계

## 🔧 고급 기술 스택

### 🐍 핵심 프레임워크
- **Python 3.8+**: 메인 프로그래밍 언어
- **discord.py 2.4.0+**: 디스코드 API 연동
- **google-generativeai 0.8.0+**: Gemini AI 모델

### 💾 데이터베이스 및 저장
- **aiosqlite**: 비동기 SQLite 데이터베이스
- **sqlalchemy**: ORM 및 데이터베이스 관리
- **alembic**: 데이터베이스 마이그레이션

### 🌐 웹 및 네트워킹
- **aiohttp**: 비동기 HTTP 클라이언트
- **beautifulsoup4**: HTML 파싱
- **requests**: HTTP 요청 처리
- **wikipedia**: 위키피디아 API
- **google-search-results**: SerpAPI 클라이언트
- **serpapi**: 구글 검색 API 연동

### 🎨 이미지 및 시각화
- **Pillow**: 이미지 처리
- **matplotlib**: 차트 및 그래프 생성
- **numpy**: 수치 계산
- **opencv-python**: 고급 이미지 처리

### 📊 데이터 분석
- **pandas**: 데이터 분석 및 처리
- **plotly**: 인터랙티브 시각화
- **seaborn**: 통계 시각화

### 🛡️ 보안 및 모니터링
- **cryptography**: 암호화 및 보안
- **psutil**: 시스템 모니터링
- **prometheus-client**: 메트릭 수집

### ⚡ 성능 최적화
- **asyncio-throttle**: 비동기 제한
- **aiofiles**: 비동기 파일 처리
- **redis**: 캐싱 (선택적)
- **celery**: 백그라운드 작업 (선택적)

## 🚀 주요 업그레이드 내용

### ✅ 문제 해결
- **응답 반복 문제 완전 해결**: 중복 응답 방지 시스템
- **메모리 누수 방지**: 고급 세션 관리
- **성능 최적화**: 비동기 처리 및 캐싱
- **안정성 향상**: 에러 처리 및 복구 시스템

### 🆕 새로운 기능
- **지능형 웹 검색**: SerpAPI 연동 + 기억 시스템
- **벡터 기반 기억**: 유사한 질문 자동 감지 및 재활용
- **검색 결과 캐싱**: 6시간 캐시로 빠른 응답
- **데이터 시각화**: 자동 차트 및 그래프 생성
- **시스템 모니터링**: 실시간 성능 분석
- **영구 저장**: 다중 데이터베이스 연동
- **고급 자연어 처리**: 더 정확한 의도 파악

### 🔧 시스템 개선
- **고급 레이트 리미팅**: 다단계 제한 시스템
- **스마트 메시지 분할**: 자연스러운 긴 메시지 처리
- **백그라운드 작업**: 자동 정리 및 최적화
- **성능 메트릭**: 실시간 성능 추적

## ⚠️ 중요 사항

### 🔒 절대 변경할 수 없는 설계
1. **자연어 전용 시스템**: 명령어 시스템은 절대 추가할 수 없음
2. **최고관리자 ID**: `1295232354205569075`는 절대 변경 불가
3. **보안 우회**: 최고관리자는 모든 제한 무시
4. **응답 반복 방지**: `stop_processing` 시스템 유지 필수

## 📝 라이선스
이 프로젝트는 개인 사용을 위한 것입니다.

---

**루시아와 자연스럽게 대화하세요! 🌟**